!function(a){"use strict";var b=function(a,b){this.init(a,b);};b.prototype={constructor:b,init:function(b,c){var d=this,e;this.options=c;this.$element=a(b).delegate('[data-dismiss="modal"]','click.dismiss.modal',a.proxy(this.hide,this));this.options.remote&&this.$element.find('.modal-body').load(this.options.remote);e=a('body').data('modalmanager');e.appendModal(this);this.manager=e;this.$element.on('focusin',function(a){if(a.target!=b)d.activeElement=a.target;});this.$element.on('focusout',function(a){if(a.relatedTarget){if(a.relatedTarget&&d.manager.elzIndex(a.relatedTarget)<d.zIndex)d.restoreFocus();}else if(d.options.item_options&&d.options.item_options.close_focusout)d.options.item.close_form(d.options.form_name);});this.show();this.zIndex=this.manager.elzIndex(b);},restoreFocus:function(){var b,c=this.activeElement;if(c)if(!this.elementIsActive(c))this.focusNext(c);else a(c).focus();else{b=this.tabList();if(b.length)a(b[0]).focus();else this.$element.focus();}},elementIsActive:function(a){return !(a.disabled||a.hidden||a.readOnly||a.type==='hidden');},toggle:function(){return this[!this.isShown?'show':'hide']();},show:function(){var b=a.Event('show');if(this.isShown)return;if(this.options.item_options&&this.options.item_options.transition)this.$element.addClass('fade');this.$element.trigger(b);if(b.isDefaultPrevented())return;this.escape();this.options.loading&&this.loading();this.tab();},hide:function(b){b&&b.preventDefault();b=a.Event('hide');this.$element.trigger(b);if(!this.isShown||b.isDefaultPrevented())return(this.isShown=true);this.isShown=false;this.escape();this.tab();this.isLoading&&this.loading();this.$element.removeClass('in').removeClass('animated').removeClass(this.options.attentionAnimation).removeClass('modal-overflow').attr('aria-hidden',true);a.support.transition&&this.$element.hasClass('fade')?this.hideWithTransition():this.hideModal();},layout:function(){var b=this,c=this.options.height?'height':'max-height',d=this.options.height||this.options.maxHeight,e;if(this.options.item_options&&this.options.item_options.width)e=this.options.item_options.width;else if(this.options.width)e=this.options.width;if(e){if(e>a(window).width())e=parseInt(a(window).width()*0.96);this.$element.css('width',e);if(this.options.item_options&&this.options.item_options.left!==undefined)this.$element.css('left',0).css('margin-left',this.options.item_options.left);else this.$element.css('margin-left',function(){if(/%/ig.test(e))return -(parseInt(e)/2)+'%';else return -(a(this).width()/2)+'px';});}else{this.$element.css('width','');this.$element.css('margin-left','');}this.$element.find('.modal-body').css('overflow','').css(c,'');if(this.options.item_options&&this.options.item_options.top!==undefined)this.$element.css('top',0).css('margin-top',this.options.item_options.top);else{if(d)this.$element.find('.modal-body').css('overflow','auto').css(c,d);var f=a(window).height()-10<this.$element.height();if(f||this.options.modalOverflow)this.$element.css('margin-top',0).addClass('modal-overflow');else this.$element.css('margin-top',0-this.$element.height()/2).removeClass('modal-overflow');}},getTabChildren:function(a,b){var c,d,e;if(a.nodeType===1){if(a.tabIndex>=0)b.push(a);e=a.childNodes;if(e){d=e.length;for(c=0;c<d;c++)this.getTabChildren(e[c],b);}}},tabList:function(){var a=this,b,c,d,e=[],f=[],g=[];this.getTabChildren(this.$element.get(0),g);for(b=0,c=g.length;b<c;b++){d=g[b];if(this.elementIsActive(d))if(d.tabIndex===0)e.push(d);else f.push(d);}f.sort(function(a,b){return a.tabIndex-b.tabIndex;});g=f.concat(e);return g;},tab:function(){var b,c=this;if(this.isShown&&this.options.consumeTab){this.$element.on('keydown.tabindex.modal',function(d){var e,f;b=d.which;if(b===9||((d.target.tagName!=='TABLE')&&!a(d.target).hasClass('dbtableinput'))&&(b===38||b===40))if(d.target===c.$element.get(0)){e=c.tabList();if(e.length)a(e[0]).focus();}else if(d.target.tabIndex>=0){e=c.tabList();f=e.indexOf(d.target);if(f!==-1){if((!d.shiftKey&&b===9)||b===40)f++;else f--;if(f<0)f=e.length-1;if(f>e.length-1)f=0;a(e[f]).focus();d.preventDefault();d.stopPropagation();}}});}else if(!this.isShown)this.$element.off('keydown.tabindex.modal');},escape:function(){var a=this;if(this.isShown&&this.options.keyboard){if(!this.$element.attr('tabindex'))this.$element.attr('tabindex',-1);this.$element.on('keyup.dismiss.modal',function(b){b.which==27&&a.hide();});}else if(!this.isShown)this.$element.off('keyup.dismiss.modal');},hideWithTransition:function(){var b=this,c=setTimeout(function(){b.$element.off(a.support.transition.end);b.hideModal();},500);this.$element.one(a.support.transition.end,function(){clearTimeout(c);b.hideModal();});},hideModal:function(){var a=this.options.height?'height':'max-height';var b=this.options.height||this.options.maxHeight;if(b)this.$element.find('.modal-body').css('overflow','').css(a,'');this.$element.hide().trigger('hidden');},removeLoading:function(){this.$loading.remove();this.$loading=null;this.isLoading=false;},loading:function(b){b=b||function(){};var c=this.$element.hasClass('fade')?'fade':'';if(!this.isLoading){var d=a.support.transition&&c;this.$loading=a('<div class="loading-mask '+c+'">').append(this.options.spinner).appendTo(this.$element);if(d)this.$loading[0].offsetWidth;this.$loading.addClass('in');this.isLoading=true;d?this.$loading.one(a.support.transition.end,b):b();}else if(this.isLoading&&this.$loading){this.$loading.removeClass('in');var e=this;a.support.transition&&this.$element.hasClass('fade')?this.$loading.one(a.support.transition.end,function(){e.removeLoading();}):e.removeLoading();}else if(b)b(this.isLoading);},focus:function(){var a=this.$element.find(this.options.focusOn);a=a.length?a:this.$element;a.focus();},attention:function(){if(this.options.attentionAnimation){this.$element.removeClass('animated').removeClass(this.options.attentionAnimation);var a=this;setTimeout(function(){if(a.$element)a.$element.addClass('animated').addClass(a.options.attentionAnimation);},0);}this.focus();},destroy:function(){var b=a.Event('destroy');this.$element.trigger(b);if(b.isDefaultPrevented())return;this.teardown();},teardown:function(){if(!this.$parent.length){this.$element.remove();this.$element=null;return;}if(this.$parent!==this.$element.parent())this.$element.appendTo(this.$parent);this.$element.off('.modal');this.$element.removeData('modal');this.$element.removeClass('in').attr('aria-hidden',true);},focusNext:function(b){var c=this.tabList(),d;if(!b)b=document.activeElement;d=c.indexOf(b);if(d!==-1){d++;if(d>c.length-1)d=0;a(c[d]).focus();}else if(c.length)a(c[0]).focus();}};a.fn.modal=function(c,d){return this.each(function(){var d=a(this),e=d.data('modal'),f=a.extend({},a.fn.modal.defaults,d.data(),typeof c=='object'&&c);if(!e)d.data('modal',(e=new b(this,f)));if(typeof c=='string')e[c]();});};a.fn.modal.defaults={item_options:null,keyboard:true,backdrop:true,loading:false,width:null,height:null,maxHeight:null,modalOverflow:false,consumeTab:true,focusOn:null,replace:false,resize:true,attentionAnimation:'shake',spinner:'<div class="loading-spinner" style="width: 200px; margin-left: -100px;"><div class="progress progress-striped active"><div class="bar" style="width: 100%;"></div></div></div>'};a.fn.modal.Constructor=b;a(function(){a(document).off('click.modal').on('click.modal.data-api','[data-toggle="modal"]',function(b){var c=a(this),d=c.attr('href'),e=a(c.attr('data-target')||(d&&d.replace(/.*(?=#[^\s]+$)/,''))),f=e.data('modal')?'toggle':a.extend({remote:!/#/.test(d)&&d},e.data(),c.data());b.preventDefault();e.modal(f).one('hide',function(){c.focus();});});});}(window.jQuery);